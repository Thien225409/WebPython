{% extends "base.html" %}
{% block title %}Danh sách sản phẩm – Meat Shop{% endblock %}

{% block content %}
  <h1>Danh sách sản phẩm</h1>
  {% if request.user and request.user.is_admin %}
    <p><a href="/product/new">➕ Tạo sản phẩm mới</a></p>
  {% endif %}

  <div class="product-grid">
    {% for p in products %}
      <div class="product-card">
        <a href="/product/{{ p.product_id }}">
          <img src="{{ p.image_url }}" alt="{{ p.name }}">
        </a>
        <div class="card-body">
          <h2>{{ p.name }}</h2>
          <p class="price">{{ "{:,.0f}".format(p.price) }}₫</p>

          <div class="actions">
            <!-- Xem chi tiết -->
            <form action="/product/{{ p.product_id }}" method="get">
              <button type="submit">Xem chi tiết</button>
            </form>

            <!-- Thêm vào giỏ (chỉ user thường) -->
            {% if request.user and not request.user.is_admin %}
              <form action="/cart/add" method="post" style="margin:0;">
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                <input type="hidden" name="product_id" value="{{ p.product_id }}">
                <button type="submit">Thêm vào giỏ</button>
              </form>
            {% endif %}
          </div>

          {% if request.user and request.user.is_admin %}
            <p>
              <a href="/product/{{ p.product_id }}/edit">✏️</a>
              <form action="/product/{{ p.product_id }}/delete" method="post" style="display:inline;">
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                <button type="submit">🗑️</button>
              </form>
            </p>
          {% endif %}
        </div>
      </div>
    {% endfor %}
  </div>
{% endblock %}
